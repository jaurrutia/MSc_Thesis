% !TeX root = ../tesis.tex

The electric and magnetic fields, denoted as $\vb{E}$ and $\vb{B}$, respectively, corresponds to a solution to the homogeneous vectorial Helmholtz \textcolor{red}{equation} when a harmonic time dependence and a spatial domain with no external charge nor current densities is assumed, that is,
% ---------------------------- index entries
\index{Helmholtz!Equation!Vectorial}%
% ---------------------------eq:Helmholtz-----
\begin{tcolorbox}[title = Vectorial Helmholtz Equation,	ams align, breakable]
	\grad^2 \vb{E}(\vb{r},\omega) + k^2 \vb{E}(\vb{r},\omega) = \vb{0},
		\qquad&\qquad
  	\grad^2 \vb{B}(\vb{r},\omega) + k^2 \vb{B}(\vb{r},\omega) = \vb{0}.
  	\label{eq:Helmholtz}
\end{tcolorbox}
% --------------------------eq:Helmholtz ----
%
\noindent where the vectorial operator $\grad^2$ must be understood as $\grad^2 = \nabla(\nabla\cdot) - \nabla\times\nabla\times $, and $k$ is the wave number in the matrix, which follows the dispersion relation $k = (\omega/c) n_\text{mat}$, with $n_\text{mat}=\sqrt{\mu_\text{mat}\varepsilon_\text{mat} /\mu_0\varepsilon_0}$ the refractive index of the matrix, $\mu_\text{mat}$ its magnetic permeability and $\varepsilon_\text{mat}$ its dielectric function. It is possible to build a basis set for the electric and magnetic fields as long as the elements of this basis are also solution to Eq. \eqref{eq:Helmholtz}. One alternative is to employ the following set of vector functions \cite{stratton_electromagnetic_2012}
%
% -----------------------------
\begin{subequations}
\begin{align}
	\vb{L} =& \nabla \psi,
	\label{eq:L}\\
	\vb{M} =& \nabla\times(\vb{r}\psi),
	\label{eq:M}\\
	\vb{N} =&  \frac{1}{k}\nabla\times\vb{M},
	\label{eq:N}
\end{align}%
\label{eq:VSH}%
\end{subequations}
% ------------------------------
%
that are solution to the homogeneous vectorial Helmholtz equation as long as the scalar function $\psi$ is solution to the scalar Helmholtz equation\footnote{%
	This result can be proved by considering the following: Let $f$ be $\mathcal{C}^3$ and $\vb{F}$ a $\mathcal{C}^2$. Then, it is true that $\nabla^2(\nabla f) = \nabla(\nabla^2 f)$, and $\curl(\grad^2\vb{F}) = \grad^2(\curl\vb{F})$. }%
% ---------------------------- index entries
\index{Helmholtz!Equation!Scalar}%
% ---------------------------eq:HelmholtzScalar-----
\begin{align}
	\nabla^2 \psi + k^2 \psi = 0.
\label{eq:HelmoltzScalar}
\end{align}
% ---------------------------eq:HelmholtzScalar-----
%
The triad $\left\{\vb{L},\vb{M},\vb{N}\right\}$ is a set of vectors\footnote{%
		Using the Einstein sum convention with $\epsilon_{ijk}$ the Levi-Civita symbol, Eq. \eqref{eq:M} can be written as follows: %
	 		$M_i = [\nabla\times(\vb{r}\psi)]_i
	 		=  \epsilon_{ijk}\partial_j(r_k\psi)
	 		=\psi\epsilon_{ijk}\partial_j(r_k) -\epsilon_{ikj}r_k\partial_j\psi
	 		=\psi[\nabla\times\vb{r}]_i - [\vb{r}\times\nabla\psi]_i
	 		= - [\vb{r}\times\nabla\psi]_i
	 		= [\vb{L}\times\vb{r}]_i$,%
	 	therefore $\vb{M}$ is orthogonal to $\vb{L}$ and $\vb{r}$. From Eq. \eqref{eq:N} $\vb{M}\cdot\vb{N}=0$, so $\vb{M}$ is orthogonal to $\vb{N}$. As it will be shown in Eq. \eqref{eq:VSHEvenOdd}, not necessarily $\vb{L}$ is orthogonal to $\vb{N}$ in a geometrical sense.
	} %
 that obey Helmholtz equation, \textit{i.e.}, they can be directly identified as electric or magnetic fields. The elements of the vector basis from Eq. \eqref{eq:VSH}   are known as the Vector Spherical Harmonics and are defined as  \citeauthor{stratton_electromagnetic_2012} \cite{stratton_electromagnetic_2012}, or by \citeauthor{bohren_absorption_1983} \cite{bohren_absorption_1983}, and the scalar function $\psi$ is known as the generating function of the VSH. From the definition of the VSH in Eqs. \eqref{eq:VSH} it can be seen that $\vb{L}$ has only a longitudinal component, while $\vb{M}$ has only transversal components ---specifically $\vb{M}$ is tangential to any sphere of radius $\norm{\vb{r}}$---, and $\vb{N}$ have both longitudinal and transversal components.
 % ---------------------------- index entries
 \index{Vector!Spherical Harmonics!Generating Function@{Generating Function $\psi$}}%
 % ---------------------------eq:Helmholtz-----

If spherical coordinates are chosen, and it is assumed that $\psi(r,\theta,\varphi) = R(r)\Theta(\theta)\Phi(\varphi)$, then Eq. \eqref{eq:HelmoltzScalar} can be decoupled into three ordinary differential equations:
%
% ---------------------------eq:Phi  eq:Theta  eq:Req -----
 \begin{align}
	\dv[2]{\Phi}{\varphi} &+ m^2 \Phi =0,
 		\label{eq:Phi}\\
	\frac{1}{\sin\theta}\dv{\theta}\qty(\sin\theta\dv{\Theta}{\theta}) &+ \qty[\ell(\ell+1)- \frac{m^2}{\sin^2\theta}]\Theta =0,
		\label{eq:Theta}\\
	\dv{r}\qty(r^2\dv{R}{r}) &+ \qty[ (k r)^2 - \ell (\ell +1)] R =0,
 		\label{eq:Req}
\end{align}
% ---------------------------eq:Phi  eq:Theta  eq:Req -----
%
where $\ell$ takes natural values and zero, and $\abs{m}\leq \ell$ so that $\Phi$ and $\Theta$ are uni-valued and finite on a sphere. The Eqs. \eqref{eq:Theta} and \eqref{eq:Req} can be rewritten as
%
% ------------------------------
 \begin{align}
(1-\mu^2)\dv[2]{\Theta}{\mu} - 2\mu\dv{\Theta}{\mu} + \qty[\ell(\ell+1)-\frac{m^2}{1-\mu^2}]\Theta &= 0, \qqtext{ with $\mu = \cos\theta$,}
	\label{eq:ThetaMu}\\
	\rho\dv{\rho}\qty(\rho\dv{Z}{\rho}) +  \qty[\rho^2 - \qty(\ell + \frac12)^2]Z  &= 0,  \qqtext{ with $Z = R\sqrt{\rho}$ and $\rho = kr$.}
\label{eq:Reqkr}
\end{align}
% ------------------------------
%
The solution to Eq. \eqref{eq:ThetaMu} are the associated Legendre functions $ P_\ell^m(\mu)$ and to Eq. \eqref{eq:Reqkr} the spherical Bessel functions of the first ($j_\ell$)  and second ($y_\ell$) kind, or the spherical Hankel functions of first ($h_\ell^{(1)} = j_\ell + iy_\ell$) and second ( $h_\ell^{(2)} = j_\ell - iy_\ell$)  kind. Following the convention from most Mie Scattering literature \cite{zangwill_modern_2013}, the solution to Eq. \eqref{eq:Phi} will be \textcolor{red}{decomposed} into an odd (`o') and an even (`e') \textcolor{red}{solutions}, that is, as sine and cosine functions, thus restricting the values of $m$ to non negative integers. After this,the generating function of the VSH is given by
% ---------------------------- index entries
\index{Legendre!Associated Functions@{Associated Functions $P_\ell^m(\mu)$}}%
\index{Functions!Legendre Associated}%
\index{Functions!Spherical Bessel@{Spherical Bessel $j_\ell(\rho)$ and $y_\ell(\rho)$}}%
\index{Functions!Spherical Hankel@{Spherical Hankel $h^{(1)}_\ell(\rho)$ and $h^{(2)}_\ell(\rho)$}}%
\index{Bessel!Spherical Functions@{Spherical Functions $j_\ell(\rho)$ and $y_\ell(\rho)$}}%
\index{Hankel!Spherical Functions@{Spherical Functions $h^{(1)}_\ell(\rho)$ and $h^{(2)}_\ell(\rho)$}}%
\index{Vector!Spherical Harmonics!Generating Function@{Generating Function $\psi$}}%
% -----------------------------
%\begin{subequations}
%\begin{tcolorbox}[title = $\psi$: Generating function of the vectorial spherical harmonics,	ams align, breakable]
%	\psi_{\text{e}\ell m}(r,\theta,\varphi) =& \cos(m\varphi)P_\ell^m(\cos\theta)z_\ell(kr),
%	\label{eq:psiE}\\
%	\psi_{\text{o}\ell m}(r,\theta,\varphi) =& \sin(m\varphi)P_\ell^m(\cos\theta)z_\ell(kr).
%	\label{eq:psiO}\\
%	\psi_{ { }^{\text{e}}_{\text{o}}\ell m}(r,\theta,\varphi) =& \, {\, }^{\sin(m\varphi)}_{\cos(m\varphi)}P_\ell^m(\cos\theta)z_\ell(kr).
%\end{tcolorbox}
%\label{eq:psi}
%\end{subequations}
\begin{tcolorbox}[title = $\psi$: Generating function of the vectorial spherical harmonics,	ams align, breakable]
	\psi_{ { }^{\text{e}}_{\text{o}}\ell m}(r,\theta,\varphi) =&
				\, {\, }^{\sin(m\varphi)}_{\cos(m\varphi)}	P_\ell^m(\cos\theta)z_\ell(kr),
	\label{eq:psi}
\end{tcolorbox}

% ------------------------------
%
\noindent%
where $z_\ell$ stands for any of the four solutions to the radial equation [Eq. \eqref{eq:Reqkr}]. Substituting Eq. \eqref{eq:psi} in Eqs. \eqref{eq:L}--\eqref{eq:N} one finds the VSH:
% ---------------------- index entries -------
\index{Vector!Spherical Harmonics!Spherical Coordinates}
% -----------------------------
\begin{subequations}
\begin{tcolorbox}[title = Vectorial Spherical Harmonics,	ams align, breakable]
	\vb{L}_{{ }^{\text{e}}_{\text{o}} m\ell} =&
			{\, }^{\cos(m\varphi)}_{\sin(m\varphi)} k P_\ell^m(\cos\theta)\dv{z_\ell(kr)}{(kr)}\,\vu{e}_r
 			+ {\,}^{\cos(m\varphi)}_{\sin(m\varphi)} k\frac{z_\ell(kr)}{kr}\dv{P_\ell^m(\cos\theta)}{\theta} \,\vu{e}_\theta +  \notag \\
			&  {\, }^{-\sin(m\varphi)}_{+\cos(m\varphi)} km \frac{P_\ell^m(\cos\theta)}{\sin\theta}\frac{z_\ell(kr)}{kr} \,\vu{e}_\varphi
	\label{eq:Leoml}\\
	\vb{M}_{{ }^{\text{e}}_{\text{o}} m\ell} = &
			{\, }^{-\sin(m\varphi)}_{+\cos(m\varphi)} m z_\ell(kr) \frac{P_\ell^m(\cos\theta)}{\sin\theta}\,\vu{e}_\theta
			-{\, }^{\cos(m\varphi)}_{\sin(m\varphi)} z_\ell(kr) \dv{P_\ell^m(\cos\theta)}{\theta}(\cos\theta)\,\vu{e}_\varphi,
	\label{eq:Meoml} \\
	\vb{N}_{{ }^{\text{e}}_{\text{o}} m\ell} = &
			{\, }^{\cos(m\varphi)}_{\sin(m\varphi)} \frac{z_\ell(kr)}{kr} \ell(\ell+1)P_\ell^m(\cos\theta)\,\vu{e}_r
			+ {\, }^{\cos(m\varphi)}_{\sin(m\varphi)}  \frac{1}{kr} \dv{[kr\, z_\ell(kr)] }{(kr)}
						\dv{P_\ell^m(\cos\theta)}{\theta}(\cos\theta)\,\vu{e}_\theta +  \notag\\
			&  {\, }^{-\sin(m\varphi)}_{+\cos(m\varphi)} m \frac{1}{kr} \dv{[kr\, z_\ell(kr)] }{(kr)}\frac{P_\ell^m(\cos\theta)}{\sin\theta}
		 \,\vu{e}_\varphi,
	\label{eq:Neoml}
\end{tcolorbox}
\label{eq:VSHEvenOdd}
\end{subequations}
\noindent
where the term $\ell( \ell+1)P_\ell^m$ arises since the associated Legendre functions obeys Eq. \eqref{eq:ThetaMu}.

The choice at $z_\ell$ in Eqs. \eqref{eq:VSHEvenOdd} is due to the physical constraints of the scattering problem. On the one hand, the spherical Bessel function of first kind, unlike the other three proposed solutions to the radial equation, is finite at $r = 0$, thus it is appropriate for the internal electric field and plane waves. This choice at $z_\ell$ will be denoted in the VSH with the superscript $(1)$. On the other hand, the asymptotic behavior ($\ell\ll \rho$) of the Hankel function of first kind $h^{(1)} = j_\ell + i y_\ell$ and its derivative \textcolor{red}{represent} outgoing spherical waves \cite{bohren_absorption_1983}
% ---------- index entries -------------
\index{Wave!Plane}
\index{Wave!Spherical}
\index{Functions!Spherical Hankel@{Spherical Hankel $h^{(1)}_\ell(\rho)$ and $h^{(2)}_\ell(\rho)$}!Asymptotic Limit}%
\index{Hankel!Spherical Functions@{Spherical Functions $h^{(1)}_\ell(\rho)$ and $h^{(2)}_\ell(\rho)$}!Asymptotic Limit}%
\index{Hankel!Spherical Functions@{Spherical Functions $h^{(1)}_\ell(\rho)$ and $h^{(2)}_\ell(\rho)$}!Asymptotic Limit}%
\index{Vector!Spherical Harmonics@{Spherical Harmonics $\{\vb{L}^{(1)},\vb{M}^{(1)},\vb{N}^{(1)}\}$}}%
\index{Vector!Spherical Harmonics@{Spherical Harmonics $\{\vb{L}^{(3)},\vb{M}^{(3)},\vb{N}^{(3)}\}$}}%
% -----------------------------
\begin{align}
	h_\ell^{(1)}(\rho)\approx (-i)^\ell \frac{\exp(i\rho)}{i\rho}
		\qqtext{and}
	\dv{h_\ell^{(1)}(\rho)}{\rho} \approx (-i)^\ell \frac{\exp(i\rho)}{\rho},
\end{align}
% -----------------------------
which are \textcolor{red}{well} suited for the scattered field; the VSH with $z_\ell = h^{(1)}_\ell$ will be denoted with the superscript $(3)$.

From here on, the VSH will be those defined in Eq. \eqref{eq:VSH} under the condition of being a solution to the vectorial Helmholtz equation, which lead to the generating function $\psi$ to be a solution to the scalar Helmholtz equation. Nevertheless, there are other definitions for the VSH as discussed by \citeauthor{barrera_vector_1985} \cite{barrera_vector_1985}. The chosen definition of the VSH allows the VSH to be interpreted directly as electric and magnetic fields, specifically identifying $\vb{N}$ with the electric contribution and $\vb{M}$ with the magnetic due to its behavior in the far field regime\footnote{The VSH $\vb{L}$ is left out from the identification of either an electric or magnetic contribution since it is purely longitudinal and thus \textcolor{red}{not suitable for} the far field.}, as it will be shown in Section \ref{sss:LSPR}.
